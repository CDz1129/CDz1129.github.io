---
layout:     post
title:      Golangå­¦ä¹ ç¬”è®°åä¸€
subtitle:   é¢å‘æ¥å£-æ¥å£çš„å®šä¹‰ä¸å®ç°
date:       2019-02-01
author:     CDz
header-img: img/post-bg-ios9-web.jpg
catalog: true
tags:
    - Golang
---

[ä¸Šä¸€ç¯‡](https://cdz1129.github.io/2019/01/31/golang%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%8D%81/)æˆ‘ä»¬ä»‹ç»äº†duck typingæ¦‚å¿µ,ä¸»è¦è®²è¿°GOè¯­è¨€ä¸­,å¦‚ä½•è§£å†³duck typingä¸­ç¼–è¯‘å™¨ä¸æç¤ºé”™è¯¯,å’Œæ²¡æœ‰duck typingçš„Javaçµæ´»æ€§ä¸å¤Ÿé—®é¢˜.
# å¦‚ä½•å®šä¹‰ä¸€ä¸ªæ¥å£

GOä¸­å®šä¹‰æ¥å£å¯ä»¥ä½¿ç”¨å…³é”®å­—`interface`

```
type Retriever interface { //ä½¿ç”¨interfaceå…³é”®å­—
    Get(url string)string //æ¥å£çš„æ–¹æ³•
}
```



# æ¥å£çš„å®ç°
ç„¶åå®šä¹‰ä¸€ä¸ªå‡½æ•°,å‚æ•°ä¸ºæˆ‘ä»¬å®šä¹‰çš„`Retriever`

```
func download(r Retriever) string {//å‚æ•°ä¸º Retriever æ¥å£
    return r.Get("http://www.imooc.com")
}
```

æ‰€æœ‰å®ç°äº†Retrieveræ¥å£çš„ç»“æ„ä½“éƒ½å¯ä»¥ä¼ å…¥å‡½æ•°.

å®šä¹‰ä¸€ä¸ªç»“æ„ä½“
```
package mook

type Retriever struct {
    Contents string
}

func (r Retriever) Get(url string) string {
    return r.Contents
}
```
å¯ä»¥çœ‹åˆ°æ¬¡ç»“æ„ä½“,åœ¨å½¢å¼ä¸Š,ä¸æˆ‘ä»¬å®šä¹‰çš„`Retriever interface`æ²¡æœ‰ä»»ä½•è”ç³».åªæ˜¯é‡Œé¢æœ‰ä¸€ä¸ªGetæ–¹æ³•,å‚æ•°ä¸è¿”å›å€¼ä¸æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•ä¸€æ ·.

æµ‹è¯•:

```
func main() {
    var r Retriever = mook.Retriever{"this is a fake imook.com"}
    s := download(r)
    fmt.Println(s)
}
```

çœ‹åˆ°æ˜¯å¯ä»¥æ‰“å°çš„,å³åœ¨æ¥å£çš„å®ç°ä¸Š,GOè¯­è¨€æ˜¯æœ‰å®ç°è€…æ¥æ§åˆ¶çš„.

è¿™æ ·åšçš„å¥½å¤„?æˆ‘ä»¬å†æ¥å®éªŒä¸€ä¸‹æŠŠ`mook.Retriever`ä¸­Getæ–¹æ³•åˆ é™¤.å¯ä»¥çœ‹åˆ°è°ƒç”¨downloadå‡½æ•°æ—¶,ä¼šæŠ¥é”™.è¿™æ˜¯åœ¨ç¼–è¯‘å™¨æ—¶å°±æŠ¥é”™,å¯¹äºç¼–ç¨‹äººå‘˜éå¸¸çš„å‹å¥½.ä¸è‡³äºåœ¨è¿è¡Œæ—¶æŠ¥é”™.å…·æœ‰äº†Javaæ¥å£å®šä¹‰çš„ç‰¹æ€§,ä½†æ˜¯åœ¨å®ç°ä¸Šåˆä¸æ¥å£æ— å…³,ä¹Ÿå°±æ˜¯è¯´,æ¥å£çš„å˜åŒ–æ˜¯ä¸ä¼šå¼ºåˆ¶å½±å“å…¶ä»–å®ç°è€…çš„.åªæœ‰åœ¨å®ç°è€…ä½¿ç”¨å…¶æ”¹å˜çš„æ¥å£åœ°æ–¹éœ€è¦ä¿®æ”¹.

å®ç°ä¸€ä¸ªHTTPè¯·æ±‚çš„`Retriever`
```
package real

import (
    "net/http"
    "net/http/httputil"
    "time"
)

type Retriever struct {

    UserAgent string
    TimeOut time.Duration

}

func (r Retriever) Get(url string) string {

    resp, err := http.Get(url)

    if err!=nil {
        panic(err) //è¿™é‡Œæˆ‘ä»¬é‡åˆ°é”™è¯¯å°±panicå…¶å®æ˜¯ä¸å¯¹çš„,
                    //åé¢ä¼šè®²åˆ°æ­£ç¡®å¤„ç†é”™è¯¯çš„æ–¹å¼
    }

    result, err := httputil.DumpResponse(resp, true)

    resp.Body.Close()
    if err!=nil {

        panic(err)

    }
    return string(result)
}
```
# æ¥å£çš„ç±»å‹åˆ¤æ–­

æ¥å£ç±»å‹å¦‚ä½•å»åˆ¤æ–­?åœ¨Javaä¸­æ˜¯ä½¿ç”¨`instanceof`æ¥åˆ¤æ–­æ¥å£æ˜¯å¦æ˜¯æŒ‡å®šç±»å‹.åœ¨GOè¯­è¨€ä¸­æœ‰ä¸¤ç§æ–¹å¼.

- type switch
- type assertion

```
//type switch
    switch v:=r.(type) {
    case mook.Retriever:
        fmt.Println("Contents:",v.Contents)
    case real2.Retriever:
        fmt.Println("UserAgent:",v.UserAgent)

    }
```
```
    //type assertion
    if retriever,ok := r.(real2.Retriever);ok{
        fmt.Println(retriever.UserAgent)
    }else if retriever,ok := r.(mook.Retriever) ;ok{
        fmt.Println(retriever.Contents)
    }else {
        fmt.Println("ç±»å‹é”™è¯¯")
    }
```

ä¸€èˆ¬ä½¿ç”¨`type assertion`æ¥åˆ¤æ–­æ¥å£çš„ç±»å‹.è¿™é‡Œæˆ‘ä»¬å‘ç°å…¶å®è¿™æ˜¯ä¸€ä¸ª**ç±»å‹è½¬æ¢**,è€Œä¸”GOè¯­è¨€ä¸­,ç±»å‹è½¬æ¢è¿˜ä¼šç»™æˆ‘ä»¬è¿”å›ä¸¤ä¸ªå€¼,ç¬¬ä¸€ä¸ªæ˜¯è½¬æ¢çš„ç±»å‹,ç¬¬äºŒä¸ªæ˜¯å¦è½¬æ¢æˆåŠŸ.

# æ¥å£é‡Œé¢æ˜¯ä»€ä¹ˆä¸œè¥¿?

è¿™ä¸€å°èŠ‚æˆ‘ä»¬æ¥ç ”ç©¶ä¸€ä¸‹,æ¥å£é‡Œé¢æ˜¯ä»€ä¹ˆä¸œè¥¿.

```
func main() {
    var r Retriever = mook.Retriever{"this is a fake imook.com"}
    fmt.Printf("%T %v\n",r,r)
    r= real2.Retriever{
        UserAgent:"Mozilla/5.0",
        TimeOut:time.Minute,
    }
    fmt.Printf("%T %v\n",r,r)
}
```

æ‰“å°:
```
mook.Retriever {this is a fake imook.com}
real.Retriever {Mozilla/5.0 1m0s}
```

å¯ä»¥çœ‹å‡ºinterface å…¶å†…éƒ¨æœ‰ä¸€ä¸ª interface ç±»å‹å’Œå€¼ (å€¼ä¹Ÿå¯ä»¥æ˜¯æŒ‡é’ˆ)

æ‰€ä»¥,å…¶å®interfaceæ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„,å…¶ä¸­åŒ…å«äº†æ¥å£çš„ç±»å‹ä¸å®ç°è€…çš„å€¼.

------
ä½œè€…æ‰€æœ‰çš„å­¦ä¹ æºç åœ¨ [goå­¦ä¹ æºç githubåœ°å€](https://github.com/CDz1129/golang-learn),å¦‚æœè§‰å¾—æœ‰ç”¨çš„è¯å¸®å°æ™ºè´¡çŒ®ä¸€ä¸ªstarğŸ˜
