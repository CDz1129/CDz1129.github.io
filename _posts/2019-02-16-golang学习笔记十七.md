---
layout:     post
title:      Golangå­¦ä¹ ç¬”è®°åä¸ƒ
subtitle:   èµ„æºç®¡ç†ä¸é”™è¯¯å¤„ç†-panicä¸recover
date:       2019-02-16
author:     CDz
header-img: img/post-bg-ios9-web.jpg
catalog: true
tags:
    - Golang
---

# panic

> n. ææ…Œï¼ŒæƒŠæ…Œï¼›å¤§ææ…Œ
adj. ææ…Œçš„ï¼›æ²¡æœ‰ç†ç”±çš„
vt. ä½¿ææ…Œ
vi. ååˆ†æƒŠæ…Œ

ä»ä¸­æ–‡è§£é‡Šå¯çŸ¥è¿™æ˜¯ä¸€ä¸ªéå¸¸ä¸¥é‡çš„è¯è¯­.åœ¨ä¹‹å‰çš„ç¨‹åºä¸­,æˆ‘ä»¬å¯¹äºé”™è¯¯çš„å¤„ç†å¾ˆå¤šä½¿ç”¨çš„panic,ä¸€æ—¦é‡åˆ°panicç¨‹åºå°±ä¼šè‡ªåŠ¨æŒ‚æ‰,è¿™å…¶å®æ˜¯æˆ‘ä»¬ä¸æ„¿æ„çœ‹åˆ°.åœ¨Javaä¸­æˆ‘ä»¬çŸ¥é“å¯¹äºä¸€ä¸ªé”™è¯¯çš„å¤„ç†,é€šå¸¸ä½¿ç”¨try-catch-finally,è¿™æ ·çš„ç»“æ„å¤„ç†,ä¿è¯ç¨‹åºä¸ä¼šæŒ‚æ‰.

ä½†æ˜¯,panicåœ¨é€€å‡ºç¨‹åºå‰ä¼šå…ˆæ‰§è¡Œdefer,å¦‚æœå¯ä»¥åœ¨deferä¸­å¾—åˆ°ç¨‹åºæ˜¯å¦panic,ä¸”å°†panicå¤„ç†æ‰,ä¸å‘ä¸ŠæŠ›å‡º,é‚£ä¹ˆå²‚ä¸æ˜¯å°±å¯ä»¥å¤„ç†é”™è¯¯ä¿¡æ¯äº†.

# recover

> vt. æ¢å¤ï¼›å¼¥è¡¥ï¼›é‡æ–°è·å¾—
vi. æ¢å¤ï¼›èƒœè¯‰ï¼›é‡æ–°å¾—çƒ
n. è¿˜åŸè‡³é¢„å¤‡å§¿åŠ¿

è¿™æ˜¯GOè¯­è¨€å†…ç½®å‡½æ•°,å¯ä»¥æ•æ‰ç¨‹åºå¼‚å¸¸.ä¸Šé¢æåˆ°,ç¨‹åºpanicä¹‹å,ä¼šå…ˆæ‰§è¡Œdefer,åœ¨è¿™é‡Œå¯¹é”™è¯¯æ•æ‰å°±å¯ä»¥å®Œç¾å½¢æˆé”™è¯¯å¤„ç†çš„é—­ç¯.

æŸ¥çœ‹å‡½æ•°recoverï¼š`func recover() interface{}`è¿”å›çš„æ˜¯ä¸€ä¸ªinterface{}ä¹Ÿå°±æ˜¯ä»»ä½•ç±»å‹ï¼Œä¸ºä»€ä¹ˆæ˜¯ä»»ä½•ç±»å‹è€Œä¸æ˜¯errorç±»å‹å‘¢ï¼ŸæŸ¥çœ‹`func panic(v interface{})`panicå‡½æ•°å¯çŸ¥ï¼Œæ˜¯å› ä¸ºpanicå¯ä»¥ä¼ å…¥ä»»ä½•ç±»å‹ã€‚

æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨å‰é¢æ‰€å­¦çš„ [type assertion](https://cdz1129.github.io/2019/02/01/golang%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%8D%81%E4%B8%80/#%E6%8E%A5%E5%8F%A3%E7%9A%84%E7%B1%BB%E5%9E%8B%E5%88%A4%E6%96%AD)åˆ¤æ–­ç±»å‹.

ä¸‹é¢å±•ç¤ºrecoverç”¨æ³•:
```
package main

import (
	"errors"
	"log"
)

func tryRecover() {
	defer func() {
		r := recover()
		if e,ok := r.(error); ok  {
			log.Println(e)
		}
	}()
	panic(errors.New("recoveré”™è¯¯å¤„ç†æ¼”ç¤º"))
}

func main() {
	tryRecover()
}
```

# æ€»ç»“

- panic
    + åœæ­¢å½“å‰å‡½æ•°æ‰§è¡Œ(HTTPserverä¸­æ²¡æœ‰ç»ˆæ­¢,æ˜¯å› ä¸ºserverå†…éƒ¨recoveräº†)
    + ä¸€ç›´å‘ä¸Šè¿”å›.æ‰§è¡Œæ¯ä¸€å±‚çš„defer
    + å¦‚æœæ²¡æœ‰é‡è§recover,ç¨‹åºé€€å‡º
- recover
    + ä»…åœ¨deferè°ƒç”¨æ—¶æ‰§è¡Œ
    + è·å–panicçš„å€¼
    + å¦‚æœæ— æ³•å¤„ç†,å¯ä»¥é‡æ–°panic


 
------
ä½œè€…æ‰€æœ‰çš„å­¦ä¹ æºç åœ¨ [goå­¦ä¹ æºç githubåœ°å€](https://github.com/CDz1129/golang-learn),å¦‚æœè§‰å¾—æœ‰ç”¨çš„è¯å¸®å°æ™ºè´¡çŒ®ä¸€ä¸ªstarğŸ˜
