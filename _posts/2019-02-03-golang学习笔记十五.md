---
layout:     post
title:      Golangå­¦ä¹ ç¬”è®°åå››
subtitle:   èµ„æºç®¡ç†ä¸é”™è¯¯å¤„ç†-defer
date:       2019-02-03
author:     CDz
header-img: img/post-bg-ios9-web.jpg
catalog: true
tags:
    - Golang
---

# deferæ¦‚å¿µ

deferå…¶å®å°±ç›¸å½“äºJavaä¸­çš„try{}finally{}ä¸­finallyç”¨æ³•.æˆ‘ä»¬çœ‹ä¸€ä¸‹deferçš„å®šä¹‰:

ç®€å•ä½¿ç”¨:
```
func tryDefer() {
    file, err := os.Open("README.md")
    if err!=nil {
        panic(err)
    }
    defer file.Close()//ç›´æ¥åœ¨è¿™é‡Œå†™ä¸‹å…³é—­å°±å¥½,éœ€è¦ç®¡é¡ºåº
    loop.PrintContentFile(file)//è¿™æ˜¯ä¹‹å‰ä»‹ç»æ–‡ä»¶è¯»å–å®šä¹‰çš„,æ‰“å°æ–‡ä»¶å‡½æ•°
}
```

## ç‰¹æ€§

- ç¡®ä¿è°ƒç”¨å‡½æ•°åœ¨ç»“æŸæ—¶(ä»£ç æ‰§è¡Œå®Œæˆ–return)å‘ç”Ÿ.è¿™ä¸ªäºJavaçš„finallyä»£ç å—ä½¿ç”¨.
- å‚æ•°åœ¨deferè¯­å¥æ—¶è®¡ç®—
```
func tryDefer() {
    for i := 0; i < 100; i++ {
        defer fmt.Println(i)
        if i == 10 {
            panic("num too big")

        }
    }
}
```
æ‰“å°:
```
10
9
8
7
6
5
4
3
2
1
0
panic: num too big

goroutine 1 [running]:
main.tryDefer()
    /Users/cdz/go/src/com.cdz/learngo/errhandling/defer/defer.go:29 +0x183
main.main()
    /Users/cdz/go/src/com.cdz/learngo/errhandling/defer/defer.go:36 +0x20
```
ä»æ‰“å°è¿‡ç¨‹å¯ä»¥çœ‹å‡º,deferè¯­å¥åä½¿ç”¨çš„å‚æ•°,åœ¨è°ƒç”¨æ—¶å°±å·²ç»è®¡ç®—,ä¸”è¿›å…¥deferæ ˆå†…,æœ€åå½“å‡½æ•°é€€å‡ºæ—¶,éµå¾ªå…ˆè¿›åå‡ºçš„åŸåˆ™.


- deferåˆ—è¡¨ä¸º*åè¿›å…ˆå‡º*
```
func tryDefer() {
    defer fmt.Println(2)
    fmt.Println(1)
    defer fmt.Println(3)
    return
}
```
æ‰“å°:
```
    1
    3
    2
```
è¯´æ˜åœ¨deferä¸­ï¼Œåªæœ‰åœ¨æ–¹æ³•æ‰§è¡Œå®Œå‰ï¼Œæˆ–è€…æ–¹æ³•returnä¹‹å‰æ‰ä¼šæ‰§è¡Œä¸å½±å“åŸæœ‰ä»£ç ï¼Œ
ä¸”å¤šä¸ªdeferæ˜¯æœ‰ä¸€ä¸ªæ ˆçš„ï¼Œéµå¾ªåè¿›å…ˆå‡ºçš„åŸåˆ™ã€‚

### ç»¼åˆäº‹ä¾‹

å°† [ä¸Šä¸€ç¯‡æ–æ³¢é‚£å¥‘æ•°åˆ—](https://cdz1129.github.io/2019/02/02/golang%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%8D%81%E5%9B%9B/#%E4%BA%8B%E4%BE%8B2%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97)å†™å…¥ä¸€ä¸ªæ–‡ä»¶ä¸­.

```

func writFile(filename string) {
    file, e := os.Create(filename)
    if e != nil {
        panic(e)
    }
    defer file.Close() //å¯ä»¥çœ‹åˆ°æ­£å¸¸ä½¿ç”¨æ—¶å»å…³é—­å°±å¥½,ä¸éœ€è¦è¿‡å¤šæ³¨æ„
    writer := bufio.NewWriter(file)
    defer writer.Flush()
    fibonacci := fib.Fibonacci()
    for i:=0;i<=20 ;i++  {
        fmt.Fprintln(writer,fibonacci())
    }
}
```

## deferä½¿ç”¨åœºæ™¯

- open/close
- lock/unlock
- priintHeader/printFooter


------
ä½œè€…æ‰€æœ‰çš„å­¦ä¹ æºç åœ¨ [goå­¦ä¹ æºç githubåœ°å€](https://github.com/CDz1129/golang-learn),å¦‚æœè§‰å¾—æœ‰ç”¨çš„è¯å¸®å°æ™ºè´¡çŒ®ä¸€ä¸ªstarğŸ˜
